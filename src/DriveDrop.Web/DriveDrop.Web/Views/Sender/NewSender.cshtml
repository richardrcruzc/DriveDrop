@model DriveDrop.Web.ViewModels.CustomerModel

@{
    ViewData["Title"] = "sender-NewSender";

    List<SelectListItem> listItems = new List<SelectListItem>();
    listItems.Add(new SelectListItem
    {
        Text = "pickup",
        Value = "PickUp"
    });
    listItems.Add(new SelectListItem
    {
        Text = "Drop",
        Value = "Drop",
        Selected = true
    });
    listItems.Add(new SelectListItem
    {
        Text = "Home",
        Value = "Home"
    });
}

 

<style>
    /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
    #map {
        height: 100%;
    }
    /* Optional: Makes the sample page fill the window. */
    html, body {
        height: 100%;
        margin: 0;
        padding: 0;
    }
</style>
<link type="text/css" rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500">
<style>
    #locationField, #controls {
        position: relative;
        width: 480px;
    }

    #autocomplete {
        position: relative;
        top: 0px;
        left: 0px;
        width: 99%;
    }

    .label {
        text-align: right;
        font-weight: bold;
        width: 100px;
        color: #303030;
    }

    #address {
        border: 1px solid #000090;
        background-color: #f0f0ff;
        width: 480px;
        padding-right: 2px;
    }

        #address td {
            font-size: 10pt;
        }

    .field {
        width: 99%;
    }

    .slimField {
        width: 80px;
    }

    .wideField {
        width: 200px;
    }

    #locationField {
        height: 20px;
        margin-bottom: 2px;
    }
</style>


<section class="esh-catalog-filters">
    <div class="row">
        <h2>Sender/NewSender page</h2>
    </div>
</section>
<div class="row">
    <form asp-action="NewSender" enctype="multipart/form-data" method="post">

        @Html.HiddenFor(m => m.CustomerTypeId)

        <div class="row">

            <div class="col-md-10">


                <hr />

                <div asp-validation-summary="ModelOnly" class="text-danger"></div>


            </div>

        </div>
        <div class="row">

            <div class="col-md-5">
                <h2>Profile information</h2>
                <hr />

                <div class="form-horizontal">


                    <div class="form-group">

                        <div class="col-md-12">
                            <input asp-for="FirstName" class="form-control" placeholder="First Name" />
                            <span asp-validation-for="FirstName" class="text-danger"></span>
                        </div>
                    </div>


                    <div class="form-group">

                        <div class="col-md-12">
                            <input asp-for="LastName" class="form-control" placeholder="Last Name" />
                            <span asp-validation-for="LastName" class="text-danger"></span>
                        </div>
                    </div>

                    <div class="form-group">

                        <div class="col-md-12">
                            <input asp-for="PrimaryPhone" class="form-control" placeholder="Primary Phone Number" />
                            <span asp-validation-for="PrimaryPhone" class="text-danger"></span>
                        </div>
                    </div>
                    <div class="form-group">

                        <div class="col-md-12">
                            <input asp-for="Phone" class="form-control" placeholder="Cell Number" />
                            <span asp-validation-for="Phone" class="text-danger"></span>
                        </div>
                    </div>

                    <div class="form-group">

                        <div class="col-md-12">
                            <input asp-for="Email" class="form-control" placeholder="Email Address" />
                            <span asp-validation-for="Email" class="text-danger"></span>
                        </div>
                    </div>



                </div>
            </div>

            <div class="col-md-5">

                <h2>Photo Upload</h2>
                <hr />
                <div class="image-placeholder">
                    <div class="form-horizontal">
                        <div class="form-group">
                            <div class="col-md-12">
                                <input type='file' id="imgFoto" />
                                <img id="blah" src="~/images/DefaultProfileImage.png" class="img-thumbnail img-responsive" width="220" height="220" />
                            </div>
                        </div>
                    </div>

                </div>
            </div>

        </div>
        <div class="row">
            <div class="col-md-10">
                <hr />
                <h2>Address for future pickup/drop</h2>
                <hr />
            </div>
          
        </div>
        <div class="row">
            <div class="col-md-6">
                <div class="form-horizontal">

                    <div class="form-group">

                        <div class="col-md-12">
                            <input id="autocomplete" class="form-control" placeholder="Enter your address" />

                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-2">
            <div class="form-horizontal">

                <div class="form-group">

                    <div class="col-md-12">
                        
                            <a class="btn btn-primary btn-lg" role="button" id="asPickup">pickup</a>
                        
                    </div>
                </div>
            </div>
        </div>
            <div class="col-md-2">
                <div class="form-horizontal">

                    <div class="form-group">

                        <div class="col-md-12">
                             
                                <a class="btn btn-primary btn-lg" role="button" id="asDrop">drop</a>
                            

                        </div>
                    </div>
                </div>
            </div>
        </div>
                <div class="row">
                    <div class="col-md-5">
                        <h2>Pickup Address</h2>
                        <hr />
                        <div class="form-horizontal">



                            <div class="form-group">
                                <div class="col-md-12">
                                    <input asp-for="PickupStreet" class="form-control" placeholder="Street" disabled />
                                    <span asp-validation-for="PickupStreet" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-md-12">
                                    <input asp-for="PickupCity" class="form-control" placeholder="City" disabled />
                                    <span asp-validation-for="PickupCity" class="text-danger"></span>
                                </div>
                            </div>

                            <div class="form-group">
                                <div class="col-md-12">
                                    <input asp-for="PickupZipCode" class="form-control" placeholder="Zip Code" disabled />
                                    <span asp-validation-for="PickupZipCode" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-md-12">
                                    <input asp-for="PickupState" class="form-control" placeholder="state" disabled />
                                    <span asp-validation-for="PickupState" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-md-12">
                                    <input asp-for="PickupCountry" class="form-control" placeholder="Country" disabled />
                                    <span asp-validation-for="PickupCountry" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-md-12">
                                    <input asp-for="PickupPhone" class="form-control" placeholder="Contact phone" disabled />
                                    <span asp-validation-for="PickupPhone" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-md-12">
                                    <input asp-for="PickupContact" class="form-control" placeholder="Contact person" disabled />
                                    <span asp-validation-for="PickupContact" class="text-danger"></span>
                                </div>
                            </div>


                        </div>

                    </div>



                    <div class="col-md-5">
                        <h2>Drop Address</h2>
                        <hr />
                        <div class="form-horizontal"> 

                            <div class="form-group">
                                <div class="col-md-12">
                                    <input asp-for="DeliveryStreet" class="form-control" placeholder="Street" disabled />
                                    <span asp-validation-for="DeliveryStreet" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-md-12">
                                    <input asp-for="DeliveryCity" class="form-control" placeholder="City" disabled />
                                    <span asp-validation-for="DeliveryCity" class="text-danger"></span>
                                </div>
                            </div>

                            <div class="form-group">
                                <div class="col-md-12">
                                    <input asp-for="DeliveryZipCode" class="form-control" placeholder="Zip Code" disabled />
                                    <span asp-validation-for="DeliveryZipCode" class="text-danger"></span>
                                </div>
                            </div>

                            <div class="form-group">
                                <div class="col-md-12">
                                    <input asp-for="DeliveryState" class="form-control" placeholder="state" disabled />
                                    <span asp-validation-for="DeliveryState" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-md-12">
                                    <input asp-for="DeliveryCountry" class="form-control" placeholder="Country" disabled />
                                    <span asp-validation-for="DeliveryCountry" class="text-danger"></span>
                                </div>
                            </div>

                            <div class="form-group">
                                <div class="col-md-12">
                                    <input asp-for="DeliveryPhone" class="form-control" placeholder="Contact phone" disabled/>
                                    <span asp-validation-for="DeliveryPhone" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-md-12">
                                    <input asp-for="DeliveryContact" class="form-control" placeholder="Contact person" disabled/>
                                    <span asp-validation-for="DeliveryContact" class="text-danger"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>


                <div class="row">

                    <div class="col-md-10">
                        <h2>Package picture </h2>
                        <hr />
                        <div class="form-horizontal">
                            <div class="form-group">
                                <label class="btn btn-primary" for="my-file-selector">
                                    <input id="my-file-selector" name="files" type="file" style="display:none;" onchange="$('#upload-file-info').html($(this).val());">
                                    Click here to upload package picture
                                </label>
                                <span class='label label-info' id="upload-file-info"></span>
                            </div>
                        </div>
                    </div>
                </div>




                <div class="row">



                    <div class="col-md-5">

                        <h2>
                            Delivery Information

                        </h2>
                        <hr />
                        <div class="form-horizontal">


                            <div class="form-group">
                                <div class="col-md-12">
                                    @Html.DropDownListFor(m => m.PriorityTypeId, Model.PriorityTypeList, new { @class = "form-control" })
                                    <span asp-validation-for="PriorityTypeId" class="text-danger"></span>
                                </div>
                            </div>

                            <div class="form-group">
                                <div class="col-md-12">
                                    @Html.DropDownListFor(m => m.TransportTypeId, Model.TransportTypeList, new { @class = "form-control" })
                                    <span asp-validation-for="TransportTypeId" class="text-danger"></span>
                                </div>
                            </div>

                            <div class="form-group">
                                <div class="col-md-12">
                                    @Html.DropDownListFor(m => m.PackageSizeId, Model.PackageSizeList, new { @class = "form-control" })
                                    <span asp-validation-for="PackageSizeId" class="text-danger"></span>
                                </div>
                            </div>


                            <div class="form-group">
                                <div class="col-md-12">
                                    <input asp-for="Amount" class="form-control" placeholder="Shipping value" />
                                    <span asp-validation-for="Amount" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-md-12">
                                    <input asp-for="Weight" class="form-control" placeholder="Weight lbs" />
                                    <span asp-validation-for="Weight" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-md-12">
                                    <input asp-for="Quantity" class="form-control" placeholder="Quantity" />
                                    <span asp-validation-for="Quantity" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-md-12">
                                    <textarea name="Note" class="span6" rows="3" placeholder="Note to the driver"></textarea>
                                    <span asp-validation-for="Note" class="text-danger"></span>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-md-12">
                                    <input asp-for="PromoCode" class="form-control" placeholder="Promo Code" />
                                    <span asp-validation-for="PromoCode" class="text-danger"></span>
                                </div>
                            </div>

                        </div>
                    </div>

                </div>

                <div class="row">
                    <div class="col-md-5">

                        <div class="form-group">

                            <div class="form-horizontal">

                                <h2>
                                    Enter credit information
                                </h2>
                                <hr />

                                <div class="form-group">
                                    <div class="col-md-12">
                                        <input asp-for="CardHolderName" class="form-control" placeholder="Card Holder Name" />
                                        <span asp-validation-for="CardHolderName" class="text-danger"></span>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <div class="col-md-12">
                                        <input asp-for="CardNumber" class="form-control" placeholder="Card Number" />
                                        <span asp-validation-for="CardNumber" class="text-danger"></span>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <div class="col-md-12">
                                        <input asp-for="Expiration" class="form-control" placeholder="Expiration" />
                                        <span asp-validation-for="Expiration" class="text-danger"></span>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <div class="col-md-12">
                                        <input asp-for="SecurityNumber" class="form-control" placeholder="Security Number" />
                                        <span asp-validation-for="SecurityNumber" class="text-danger"></span>
                                    </div>
                                </div>
                            </div>
                        </div>


                    </div>
                    <div class="col-md-5">
                        <div class="form-horizontal">

                            <h2>
                                Authentication Info
                            </h2>
                            <hr />
                            <div class="form-group">
                                <div class="col-md-12">
                                    <input asp-for="UserEmail" class="form-control" placeholder="User Email" />
                                    <span asp-validation-for="UserEmail" class="text-danger"></span>
                                </div>
                            </div>

                            <div class="form-group">
                                <div class="col-md-12">
                                    <input asp-for="Password" class="form-control" placeholder="Password" />
                                    <span asp-validation-for="Password" class="Password"></span>
                                </div>
                            </div>

                            <div class="form-group">
                                <div class="col-md-12">
                                    <input asp-for="ConfirmPassword" class="form-control" placeholder="Confirm Password" />
                                    <span asp-validation-for="ConfirmPassword" class="ConfirmPassword"></span>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>

                <div class="row">

                </div>

                <div class="row">
                    <div class="col-md-10">
                        <hr />
                        <h2>Shipping Total</h2>
                        <hr />
                        <div class="form-group float-xs-right">
                            <h4><label class="float-lg-left">Sub Total:</label><label id="subtotal" class="float-xs-right label-info">0.00 </label></h4>
                            <h4><label class="float-lg-left">Discount:</label><label id="TaxDiscount" class="float-xs-right">0.00 </label></h4>
                            <h4><label class="float-lg-left">Taxes:</label><label id="totalTax" class="float-xs-right">0.00 </label></h4>
                            <h4><label class="float-lg-left">Total:</label><label id="total" class="float-xs-right">0.00 </label></h4>


                        </div>

                    </div>
                </div>


                <div class="row">
                    <div class="col-md-10">
                        <div class="form-group">
                            <div class="col-md-offset-2 col-md-10">
                                <input type="submit" value="Register" id="submitButton" class="btn btn-default" />
                            </div>
                        </div>
                    </div>
                </div>
</form>

    <div>
        <hr />
        <a asp-action="Index">Back to List</a>
    </div>
</div>
@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}


<script>
  
    //    $('input#submitButton').click(function () {

    //        $.ajax({
    //            url: '/driver/NewDriver',
    //            type: 'post',
    //           // dataType: 'json',
    //            data: $('form#myForm').serialize(),
    //            success: function (data) {
    //                alert("good");
    //                 }
    //    });
    //});



    jQuery('#PickupZipCode').on('input propertychange paste', function () {
        UpdateRate()
    });
    jQuery('#DeliveryZipCode').on('input propertychange paste', function () {
        UpdateRate()
    });
    jQuery('#Quantity').on('input propertychange paste', function () {
        UpdateRate()
    });
    jQuery('#Amount').on('input propertychange paste', function () {
        UpdateRate()
    });

    $("#TransportTypeId").change(function () {
        UpdateRate()
    });

    $("#PriorityTypeId").change(function () {
        UpdateRate()
    });

    $("#PromoCode").change(function () {
        UpdateRate()
    });

    function UpdateRate() {


        // var myLength = $("#PickupZipCode").val().length;
        var delLength = $("#DeliveryZipCode").val().length;
        var delZip = $("#DeliveryZipCode").val();
        if (delLength < 5)
            return;

        var pickupLength = $("#PickupZipCode").val().length;
        var pickupZip = $("#PickupZipCode").val();
        if (pickupLength < 5)
            return;



        var weight = $("#Weight").val();
        var quantity = $("#Quantity").val();
        var amount = $("#Amount").val();
        var transportTypeId = $("#TransportTypeId").val();
        if (transportTypeId == 'Prority')
            return;
        var priorityTypeId = $("#PriorityTypeId").val();
        if (priorityTypeId == 'Transport Type')
            return;


        var promoCode = $("#PromoCode").val();

        if (quantity != '' && amount != '' && transportTypeId != '' && priorityTypeId != '') {
            //  alert("weight "+weight+"quantity:" + quantity + "amount:" + amount + "transportTypeId:" + transportTypeId + "priorityTypeId:" + priorityTypeId);

            $.ajax({
                url: '@Url.Action("CalculateAmount", "rates")' , // to get the right path to controller from TableRoutes of Asp.Net MVC
                                dataType: "json", //to work with json format
                                type: "POST", //to do a post request

                                //  contentType: 'application/json; charset=utf-8', //define a contentType of your request
                                cache: false, //avoid caching results
                                data: { zipFrom: pickupZip, zipTo: delZip, weight: weight, qty: quantity, priority: priorityTypeId, transportTypeId: transportTypeId, promoCode: promoCode}, // here you can pass arguments to your request if you need
                                success: function (data) {
                                // data is your result from controller
                                if (data) {

                                $("#subtotal").text(data.strSubTotal);
                                $("#TaxDiscount").text(data.strDiscount);
                                $("#totalTax").text(data.strTaxAmount);
                                $("#total").text(data.strAmountToCharge);

                                }

                                },
                                error: function (xhr, ajaxOptions, thrownError) {
                                alert(xhr.responseText);
                                //alert(xhr.status);
                                //alert(thrownError);

                                }
                                });
                                }
                     }


                     function readURL(input) {

                         if (input.files && input.files[0]) {
                             var reader = new FileReader();

                             reader.onload = function (e) {
                                 $('#blah').attr('src', e.target.result);
                             }

                             reader.readAsDataURL(input.files[0]);
                         }
                     }

                     $("#imgFoto").change(function () {
                         readURL(this);
                     });

                     $("#asPickup").click(function () { 

                         // Get the place details from the autocomplete object.
                         var place = autocomplete.getPlace();
                         // Get each component of the address from the place details
                         // and fill the corresponding field on the form.
                         for (var i = 0; i < place.address_components.length; i++) {
                             var addressType = place.address_components[i].types[0];
                             if (componentForm[addressType]) {
                                 var val = place.address_components[i][componentForm[addressType]];
                                
                                 if (addressType == 'street_number')
                                     $("#PickupStreet").val(place.address_components[i]['short_name']);

                                 if (addressType == 'route')
                                     $("#PickupStreet").val($("#PickupStreet").val()+" "+place.address_components[i]['long_name']);

                                 if (addressType == 'locality' )
                                     $("#PickupCity").val(place.address_components[i]['long_name']);

                                 if (addressType == 'administrative_area_level_1' )
                                     $("#PickupState").val(place.address_components[i]['short_name']);

                                 if (addressType == 'country' )
                                     $("#PickupCountry").val(place.address_components[i]['long_name']);

                                 if (addressType == 'postal_code' )
                                 $("#PickupZipCode").val(place.address_components[i]['short_name']);
                                  
                             }
                         }

                         document.getElementById('PickupPhone').disabled = false;
                         document.getElementById('PickupContact').disabled = false;

                         document.getElementById('autocomplete').value = '';
                     });

                     $("#asDrop").click(function () {
                         // Get the place details from the autocomplete object.
                         var place = autocomplete.getPlace();
                         // Get each component of the address from the place details
                         // and fill the corresponding field on the form.
                         for (var i = 0; i < place.address_components.length; i++) {
                             var addressType = place.address_components[i].types[0];
                             if (componentForm[addressType]) {
                                 var val = place.address_components[i][componentForm[addressType]];

                                 if (addressType == 'street_number')
                                     $("#DeliveryStreet").val(place.address_components[i]['short_name']);

                                 if (addressType == 'route')
                                     $("#DeliveryStreet").val($("#DeliveryStreet").val() + " " + place.address_components[i]['long_name']);

                                 if (addressType == 'locality')
                                     $("#DeliveryCity").val(place.address_components[i]['long_name']);

                                 if (addressType == 'administrative_area_level_1')
                                     $("#DeliveryState").val(place.address_components[i]['short_name']);

                                 if (addressType == 'country')
                                     $("#DeliveryCountry").val(place.address_components[i]['long_name']);

                                 if (addressType == 'postal_code')
                                     $("#DeliveryZipCode").val(place.address_components[i]['short_name']);

                             }
                         }

                         document.getElementById('DeliveryPhone').disabled = false;
                         document.getElementById('DeliveryContact').disabled = false;

                         document.getElementById('autocomplete').value = '';
                     });


// This example displays an address form, using the autocomplete feature
      // of the Google Places API to help users fill in the information.

      // This example requires the Places library. Include the libraries=places
      // parameter when you first load the API. For example:
      // <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&libraries=places">

      var placeSearch, autocomplete;
      var componentForm = {
        street_number: 'short_name',
        route: 'long_name',
        locality: 'long_name',
        administrative_area_level_1: 'short_name',
        country: 'long_name',
        postal_code: 'short_name'
      };

      function initAutocomplete() {
        // Create the autocomplete object, restricting the search to geographical
        // location types.
        autocomplete = new google.maps.places.Autocomplete(
            /** type {!HTMLInputElement} */(document.getElementById('autocomplete')),
            {types: ['geocode']});

        // When the user selects an address from the dropdown, populate the address
        // fields in the form.
       // autocomplete.addListener('place_changed', fillInAddress);

          
      }

      function fillInAddress() {
        // Get the place details from the autocomplete object.
        var place = autocomplete.getPlace();

        for (var component in componentForm) {

          document.getElementById(component).value = '';
          document.getElementById(component).disabled = false;
        }

        // Get each component of the address from the place details
        // and fill the corresponding field on the form.
        for (var i = 0; i < place.address_components.length; i++) {
          var addressType = place.address_components[i].types[0];
          if (componentForm[addressType]) {
              var val = place.address_components[i][componentForm[addressType]];

              document.getElementById(addressType).value = '';
              document.getElementById(addressType).disabled = false;
           document.getElementById(addressType).value = val;
          }
        }
      }

      // Bias the autocomplete object to the user's geographical location,
      // as supplied by the browser's 'navigator.geolocation' object.
      function geolocate() {
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(function(position) {
            var geolocation = {
              lat: position.coords.latitude,
              lng: position.coords.longitude
            };
            var circle = new google.maps.Circle({
              center: geolocation,
              radius: position.coords.accuracy
            });
            autocomplete.setBounds(circle.getBounds());
          });
        }
      }
</script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCwSXLEryUNhIeBBzRN1qxNrqs7Tq15P6o&libraries=places&callback=initAutocomplete"
        async defer></script>
}
