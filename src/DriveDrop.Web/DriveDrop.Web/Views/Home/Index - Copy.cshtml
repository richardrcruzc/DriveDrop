@model DriveDrop.Web.ViewModels.HomeQuote

@{
    ViewData["Title"] = "Home Page";
}


<div id="myCarousel" class="carousel slide" data-ride="carousel" data-interval="6000">
    <ol class="carousel-indicators">
        @*<li data-target="#myCarousel" data-slide-to="0" class="active"></li>*@
        @*<li data-target="#myCarousel" data-slide-to="1"></li>
        <li data-target="#myCarousel" data-slide-to="2"></li>
        <li data-target="#myCarousel" data-slide-to="3"></li>
        <li data-target="#myCarousel" data-slide-to="4"></li>*@
    </ol>
    <div class="carousel-inner" role="listbox">
        <div class="item active">
            <img src="~/images/slider_img.jpg" />
            <img src="~/images/slider_img.jpg" style="height: 380px;width: 1400px;" alt="DriveDrop" class="img-responsive" />

            <div class="carousel-caption" role="option">
               
                @if (User.FindFirst(x => x.Type == "preferred_username") == null)
                {
                    @*<p>
                    Learn how to 
                    
                    <a class="btn btn-default" href="/sender/NewSender">
                        <h2>Register as Sender  &raquo;</h2>

                    </a>

                   
                </p>
                <p>
                    Learn how to
 

                    <a class="btn btn-default" href="/Driver/NewDriver">
                        <h2>Register as Driver  &raquo;</h2>

                    </a>
                </p>*@
                }
                else
                {

                    @*<div class="row">
                        <div class="col-md-1">
                        </div>
                        <div class="col-md-10">
                            <a class="btn btn-default" href="/home/myAccount">
                                <h2>Go to myAccount&raquo;</h2>

                            </a>
                        </div>

                        <div class="col-md-1">
                        </div>
                    </div>*@

                }
            </div>
        </div>
        @*<div class="item">
            <img src="~/images/banner1.svg" alt="ASP.NET" class="img-responsive" />
            
            <div class="carousel-caption" role="option">
                <img src="~/images/DriveDroplogo.png" />
                <p>
                    Learn how to build ASP.NET apps that can run anywhere.
                    <a class="btn btn-default" href="https://go.microsoft.com/fwlink/?LinkID=525028&clcid=0x409">
                        Learn More
                    </a>
                </p>
            </div>
        </div>
        <div class="item">
            <img src="~/images/banner2.svg" alt="Visual Studio" class="img-responsive" />
            <div class="carousel-caption" role="option">
                <p>
                    There are powerful new features in Visual Studio for building modern web apps.
                    <a class="btn btn-default" href="https://go.microsoft.com/fwlink/?LinkID=525030&clcid=0x409">
                        Learn More
                    </a>
                </p>
            </div>
        </div>
        <div class="item">
            <img src="~/images/banner3.svg" alt="Package Management" class="img-responsive" />
            <div class="carousel-caption" role="option">
                <p>
                    Bring in libraries from NuGet, Bower, and npm, and automate tasks using Grunt or Gulp.
                    <a class="btn btn-default" href="https://go.microsoft.com/fwlink/?LinkID=525029&clcid=0x409">
                        Learn More
                    </a>
                </p>
            </div>
        </div>
        <div class="item">
            <img src="~/images/banner4.svg" alt="Microsoft Azure" class="img-responsive" />
            <div class="carousel-caption" role="option">
                <p>
                    Learn how Microsoft's Azure cloud platform allows you to build, deploy, and scale web apps.
                    <a class="btn btn-default" href="https://go.microsoft.com/fwlink/?LinkID=525027&clcid=0x409">
                        Learn More
                    </a>
                </p>
            </div>
        </div>*@
    </div>
    @*<a class="left carousel-control" href="#myCarousel" role="button" data-slide="prev">
        <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
        <span class="sr-only">Previous</span>
    </a>
    <a class="right carousel-control" href="#myCarousel" role="button" data-slide="next">
        <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
        <span class="sr-only">Next</span>
    </a>*@
     
</div>


 @*@if (User.FindFirst(x => x.Type == "preferred_username") == null)
 {
<div class="jumbotron" style="background-image: url('../../../../images/slider_img.jpg');  height: 600px;    background-repeat: no-repeat;    background-size: contain; padding: 2rem 1rem;    margin-bottom: 2rem;    border-radius: 0.3rem;">
    <img src="~/images/DriveDroplogo.png" />
    

</div>
 }
 else
 {

    <div class="jumbotron">
        <img src="~/images/DriveDroplogo.png" />


    </div>
 }*@
<div class="container">
    <div class="row">

        <div class="row">
            <div class="col-lg-12">
                <div class="center text-center">
                    <h3> Estimated</h3>

                </div>
            </div>
        </div>
        <div class="row">
            <br /><br />
        </div>

        <div class="row">
            <div class="center text-center">
                <div class="col-md-2">

                    <input id="start" class="form-control autocomplete" placeholder="From Seattle, WA" />
                    <span class="text-danger"></span>

                </div>
                <div class="col-md-2">

                    <input id="end" class="form-control" placeholder="From Tacoma, WA" />
                    <span class="text-danger"></span>

                </div>
                <div class="col-md-2">

                    @Html.DropDownListFor(m => m.PackageSizeId, Model.PackageSizeList, new { @class = "form-control" })
                    <span asp-validation-for="TransportTypeId" class="text-danger"></span>

                </div>

                <div class="col-md-2">

                    @Html.DropDownListFor(m => m.PriorityTypeId, Model.PriorityTypeList, new { @class = "form-control" })
                    <span asp-validation-for="TransportTypeId" class="text-danger"></span>

                </div>

                <div class="col-md-2">

                    <input id="weight" class="form-control autocomplete" placeholder="weight" />
                    <span class="text-danger"></span>

                </div>

                <div class="col-md-2">

                    <button type="button" id="calcTotal" class="btn btn-info">Submit</button>

                </div>
            </div>
        </div>


        <div class="row">
            <div class="center text-center">
                <br /><br /><h3>
                    <label id="AmountEstimated"></label>
                </h3>
            </div>
            <br /><br />
            <br /><br />
        </div>

        <div class="row">
            <p></p>
        </div>
        @if (ViewBag.UserValid == "false")
        {
            <div class="row">
                <p><h1> user no valid !</h1></p>
            </div>
        }

        @if (User.FindFirst(x => x.Type == "preferred_username") != null)
        {
            @*<div class="row">
                <div class="col-md-1">
                </div>
                <div class="col-md-10">
                    <a class="btn btn-default" href="/home/myAccount">
                        <h2>Go to myAccount&raquo;</h2>

                    </a>
                </div>

                <div class="col-md-1">
                </div>
            </div>*@
        }
        else
        {
            <div class="row">
                <div class="col-md-1">
                </div>
                <div class="col-md-5">
                    <a class="btn btn-default" href="/sender/NewSender">
                        <h2>Register as Sender  &raquo;</h2>

                    </a>
                </div>
                <div class="col-md-5">
                    <a class="btn btn-default" href="/Driver/NewDriver">
                        <h2>Register as Driver  &raquo;</h2>

                    </a>
                </div>
                <div class="col-md-1">
                </div>
            </div>
        }
        <div class="row">
            <p></p>
        </div>

        <div class="row">
            <br /><br />
            <br /><br />
            <br /><br />
            <br /><br />
        </div>
        @*<div class="row">
                <div class="col-md-4">
                    <a class="btn btn-default" href="admin/index">
                        <h2>Super administrator</h2>
                        <p>
                            Impersonate an admin user .
                        </p>
                        Test &raquo;
                    </a>
                </div>
                <div class="col-md-4">
                    <a class="btn btn-default" href="/sender/result/2">
                        <h2>Sender dashboard</h2>
                        <p>impersonate a sender user</p>
                        Test &raquo;
                    </a>
                </div>
                <div class="col-md-4">
                    <a class="btn btn-default" href="/Driver/result/9">
                        <h2>Driver dashboard</h2>
                        <p>Impersonate a driver user.</p>
                        Test &raquo;
                    </a>
                </div>
            </div>*@

        @*<ul class="nav nav-tabs">
                <li class="active"><a data-toggle="tab" href="#home">Home</a></li>
                <li><a data-toggle="tab" href="#menu1">Menu 1</a></li>
                <li><a data-toggle="tab" href="#menu2">Menu 2</a></li>
            </ul>

            <div class="tab-content">
                <div id="home" class="tab-pane fade in active">
                    <h3>HOME</h3>
                    <p>Some content.</p>
                </div>
                <div id="menu1" class="tab-pane fade">
                    <h3>Menu 1</h3>
                    <p>Some content in menu 1.</p>
                </div>
                <div id="menu2" class="tab-pane fade">
                    <h3>Menu 2</h3>
                    <p>Some content in menu 2.</p>
                </div>
            </div>*@


    </div>

    </div>



    @section Scripts {
        @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
        <script>



        // This example displays an address form, using the autocomplete feature
        // of the Google Places API to help users fill in the information.

        // This example requires the Places library. Include the libraries=places
        // parameter when you first load the API. For example:
        // <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&libraries=places">

        var placeSearch, autocomplete, autocomplete1;
        var componentForm = {
            street_number: 'short_name',
            route: 'long_name',
            locality: 'long_name',
            administrative_area_level_1: 'short_name',
            country: 'long_name',
            postal_code: 'short_name'
        };

        function initAutocomplete() {
            // Create the autocomplete object, restricting the search to geographical
            // location types.
            autocomplete = new google.maps.places.Autocomplete(
                /** type {!HTMLInputElement} */
                (document.getElementById('start')),
                { types: ['geocode'] });
            // When the user selects an address from the dropdown, populate the address
            // fields in the form.
            //autocomplete.addListener('place_changed', fillInAddress);

            autocomplete1 = new google.maps.places.Autocomplete(
                /** type {!HTMLInputElement} */
                (document.getElementById('end')),
                { types: ['geocode'] });

            ///autocomplete1.addListener('place_changed', fillInAddress1);


        }



        // Bias the autocomplete object to the user's geographical location,
        // as supplied by the browser's 'navigator.geolocation' object.
        function geolocate() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function (position) {
                    var geolocation = {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude
                    };
                    var circle = new google.maps.Circle({
                        center: geolocation,
                        radius: position.coords.accuracy
                    });
                    autocomplete.setBounds(circle.getBounds());
                });
            }
        }

        //*******************

            $(function () {


                $('#calcTotal').click(function (event) {


            var pAdrress = $('#start').val();
            var dAddress = $('#end').val();


                    var geocoder = new google.maps.Geocoder;

                    var service = new google.maps.DistanceMatrixService;
                    service.getDistanceMatrix({
                        origins: [pAdrress],
                        destinations: [dAddress],
                        travelMode: 'DRIVING',
                        unitSystem: google.maps.UnitSystem.METRIC,
                        avoidHighways: false,
                        avoidTolls: false
                    }, function (response, status) {
                        if (status !== 'OK') {
                            alert('Error was: ' + status);
                        } else {
                            var originList = response.originAddresses;
                            var destinationList = response.destinationAddresses;

                            var results = response.rows[0].elements;
                            var distance = results[0].distance.text.split(" ");


                            var km = distance[0];
                            var transportTypeId = $("#TransportTypeId").val();
                            var priorityTypeId = $("#PriorityTypeId").val();
                            var promoCode = $("#PromoCode").val();
                            var weight = $("#weight").val();

                            $.ajax({
                                url: '@Url.Action("CalculateAmount", "rates")', // to get the right path to controller from TableRoutes of Asp.Net MVC
                                dataType: "json", //to work with json format
                                type: "POST", //to do a post request

                                //  contentType: 'application/json; charset=utf-8', //define a contentType of your request
                                cache: false, //avoid caching results
                                data: { distance: km, weight: weight, priority: priorityTypeId, promoCode: promoCode }, // here you can pass arguments to your request if you need
                                success: function (data) {
                                    // data is your result from controller
                                    if (data) {
                                        //$("#distance").value = km;
                                        //$(".value-Sub").text(data.strSubTotal);
                                        //$(".value-Discount").text(data.strDiscount);
                                        //$(".value-Tax").text(data.strTaxAmount);
                                        $("#AmountEstimated").addClass('alert alert-success');

                                        $("#AmountEstimated").text(data.strAmountToCharge);

                                    }

                                },
                                error: function (xhr, ajaxOptions, thrownError) {
                                    alert(xhr.responseText);
                                    //alert(xhr.status);
                                    //alert(thrownError);

                                }
                            });



                            }
                        });


                });
            });












        </script>
        <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCwSXLEryUNhIeBBzRN1qxNrqs7Tq15P6o&libraries=places&callback=initAutocomplete"
                async defer></script>
    }
