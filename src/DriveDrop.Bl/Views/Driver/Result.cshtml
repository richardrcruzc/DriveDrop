@model DriveDrop.Bl.ViewModels.DriverInfoModel

@using DriveDrop.Bl.Services
@inject StatisticsService StatsService
@{
    var isMobile = @StatsService.Mobile(); //await Component.InvokeAsync("MobileLayout");
    var top = "0px";
    if (isMobile == true)
    {
        top = "-105px";
    }
    ViewData["Title"] = "Details";


    var option = new DriveDrop.Bl.ViewModels.TwoParameterModel { Id = Model.Id, Option = "result" };
}

<section class="sender-desh">
    <div class="container">
        <div class="main-cont">
            <div class="row">

                @await Html.PartialAsync("DriverNavigation", option)

                <div id="content" class="col-sm-9" style="top: @top;">
                    <div id="gig-information" class="sender-form">
                        <h3 class="blue-head active">Driver Information</h3>
                        <div class="form-body">
                            <form data-ajax-method="POST" asp-action="UpdateInfo" enctype="multipart/form-data" id="DriverUpdateForm"
                                  data-ajax="true" data-ajax-mode="replace" data-ajax-update="#bar-notification">

                                @Html.AntiForgeryToken()


                                <input asp-for="Id" hidden />
                                <input asp-for="StatusId" hidden />
                                <input asp-for="CustomerStatus" hidden />
                                <input asp-for="PersonalPhotoUri" hidden />
                                <div class="profile-form">
                                    <div class="row">
                                        <div class="col-sm-3">
                                            <div class="profile">
                                                <input type="file" id="PhotoUrl" name="PhotoUrl" class="file-select" />
                                                <div class="photo">
                                                    <div class="avatar-page">

                                                        <img id="blah" src="@Model.PersonalPhotoUri" class="img-thumbnail img-responsive" width="150" height="150" />
                                                    </div>
                                                </div>
                                                <div class="form-field">
                                                    <div class="col-xs-12">
                                                        <label for="CustomerStatus" style="font-size:large; background:#43b249;color:#fff"> <span>Status:  @Model.CustomerStatus</span> </label>

                                                    </div>
                                                </div>
                                            </div>


                                        </div>

                                        <div class="col-sm-9">
                                            <div class="row">


                                                <div class="fieldset">

                                                    <div class="title">
                                                        <strong>My Personal Information Details</strong>
                                                    </div>


                                                    <div class="form-fields">
                                                        <div class="form-horizontal">


                                                            <div class="form-field">
                                                                @*<div class="col-lg-12">
                                                                        <label for="CustomerStatus"><span>Status:</span> @Model.CustomerStatus</label>
                                                                    </div>*@
                                                                <br />
                                                            </div>

                                                            <div class="form-field">

                                                                <div class="col-lg-12">
                                                                    <label asp-for="FirstName"></label>
                                                                    <input asp-for="FirstName" class="form-control" placeholder="First name" />

                                                                    <span asp-validation-for="FirstName" class="text-danger"></span>
                                                                </div>
                                                            </div>

                                                            <div class="form-field">
                                                                <div class="col-lg-12">
                                                                    <label asp-for="LastName"></label>
                                                                    <input asp-for="LastName" class="form-control" placeholder="Last name" />

                                                                    <span asp-validation-for="LastName" class="text-danger"></span>
                                                                </div>
                                                            </div>

                                                            <div class="form-field">
                                                                <div class="col-lg-12">
                                                                    <label asp-for="Email"></label>
                                                                    @Html.TextBoxFor(model => model.Email, new { @class = "email form-control" })

                                                                    @Html.ValidationMessageFor(model => model.Email)
                                                                </div>
                                                            </div>
                                                            <div class="form-field">
                                                                <div class="col-lg-12">
                                                                    <label asp-for="PrimaryPhone"></label>
                                                                    @Html.TextBoxFor(model => model.PrimaryPhone, new { @data_inputmask = "'mask': '(999) 999-9999'", @class = "form-control" })

                                                                    @Html.ValidationMessageFor(model => model.PrimaryPhone)

                                                                </div>
                                                            </div>
                                                            <div class="form-field">
                                                                <div class="col-lg-12">
                                                                    <label asp-for="Phone"></label>
                                                                    @Html.TextBoxFor(model => model.Phone, new { @data_inputmask = "'mask': '(999) 999-9999'", @class = "form-control" })

                                                                    @Html.ValidationMessageFor(model => model.Phone)
                                                                </div>
                                                            </div>
                                                            <div class="form-field">
                                                                <div class="col-lg-12">
                                                                    <label asp-for="PickupRadius"></label>
                                                                    @Html.TextBoxFor(model => model.PickupRadius, new { @class = "form-control" })

                                                                    @Html.ValidationMessageFor(model => model.PickupRadius)
                                                                </div>
                                                            </div>
                                                            <div class="form-field">
                                                                <div class="col-lg-12">
                                                                    <label asp-for="DeliverRadius"></label>
                                                                    @Html.TextBoxFor(model => model.DeliverRadius, new { @class = "form-control" })

                                                                    @Html.ValidationMessageFor(model => model.DeliverRadius)

                                                                </div>
                                                            </div>

                                                            <div class="form-field">
                                                                <div class="col-lg-12">
                                                                    <label asp-for="VerificationId"></label>
                                                                    <input asp-for="VerificationId" class="form-control" placeholder="Verification Id" />

                                                                    <span asp-validation-for="VerificationId" class="text-danger"></span>
                                                                </div>
                                                            </div>
                                                            <div class="form-field">
                                                                <div class="col-lg-12">
                                                                    <br />
                                                                </div>
                                                            </div>


                                                            <div class="post-gig">
                                                                <input type="submit" value="Save" name="save-info-button" class="bttn save-customer-info-button" />
                                                            </div>
                                                            <div class="center-block bg-primary text-center" id="bar-notification">

                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="clearfix"></div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    <script>

    $(function () {
        $('form').submit(function (e) {
            e.preventDefault();

            var fdata = new FormData();
            var myform = $('#DriverUpdateForm'); // specify the form element
            var idata = myform.serializeArray();
            var document = $('input[type="file"]')[0].files[0];
            fdata.append('PhotoUrl', document);

            $.each(idata, function (key, input) {
                fdata.append(input.name, input.value);
            });



            if ($(this).valid()) {
                $.ajax({
                    url: this.action,
                    type: this.method,
                    contentType: false,
                    processData: false,
                    data: $(this).serialize(),
                    success: function (result) {
                        $('#bar-notification').html(result);
                        alert(result);
                    },
                    error: function (response) {
                        alert("Error:" + response);
                    }
                });
            }
            return false;
        });
    });



    function readURL(input) {

        if (input.files && input.files[0]) {
            var reader = new FileReader();

            reader.onload = function (e) {
                $('#blah').attr('src', e.target.result);
            }

            reader.readAsDataURL(input.files[0]);
        }
    }
    $("#photoUrl").change(function () {
        readURL(this);
    });

    function readURL4(input) {

        if (input.files && input.files[0]) {
            var reader = new FileReader();

            reader.onload = function (e) {
                $('#insurance-image').attr('src', e.target.result);
            }

            reader.readAsDataURL(input.files[0]);
        }
    }

    $("#my-file-selector-insurance").change(function () {
        readURL4(this);
    });




    function readURL3(input) {

        if (input.files && input.files[0]) {
            var reader = new FileReader();

            reader.onload = function (e) {
                $('#Vehicle-image').attr('src', e.target.result);
            }

            reader.readAsDataURL(input.files[0]);
        }
    }

    $("#my-file-selector-Vehicle").change(function () {
        readURL3(this);
    });



    function readURL2(input) {

        if (input.files && input.files[0]) {
            var reader = new FileReader();

            reader.onload = function (e) {
                $('#Personal-image').attr('src', e.target.result);
            }

            reader.readAsDataURL(input.files[0]);
        }
    }

    $("#my-file-selector-Personal").change(function () {
        readURL2(this);
    });


    function readURL1(input) {

        if (input.files && input.files[0]) {
            var reader = new FileReader();

            reader.onload = function (e) {
                $('#license-image').attr('src', e.target.result);
            }

            reader.readAsDataURL(input.files[0]);
        }
    }

    $("#my-file-selector-license").change(function () {
        readURL1(this);
    });


    var theDiv = document.getElementById("newShipmentTr");
    var button = document.getElementById("button");

    function removeRed() {

        var classContent = theDiv.className;

        theDiv.className = classContent.replace("sr-only", "").trim();
    }

    //button.addEventListener("click", removeRed, false);

    jQuery('#PickupZipCode').on('input propertychange paste', function () {
        UpdateRate()
    });
    jQuery('#DeliveryZipCode').on('input propertychange paste', function () {
        UpdateRate()
    });
    jQuery('#Quantity').on('input propertychange paste', function () {
        UpdateRate()
    });
    jQuery('#Amount').on('input propertychange paste', function () {
        UpdateRate()
    });

    $("#TransportTypeId").change(function () {
        UpdateRate()
    });

    $("#PriorityTypeId").change(function () {
        UpdateRate()
    });

    $("#PromoCode").change(function () {
        UpdateRate()
    });

    function UpdateRate() {


        // var myLength = $("#PickupZipCode").val().length;
        var delLength = $("#DeliveryZipCode").val().length;
        var delZip = $("#DeliveryZipCode").val();
        if (delLength < 5)
            return;

        var pickupLength = $("#PickupZipCode").val().length;
        var pickupZip = $("#PickupZipCode").val();
        if (pickupLength < 5)
            return;



        var weight = $("#Weight").val();
        var quantity = $("#Quantity").val();
        var amount = $("#Amount").val();
        var transportTypeId = $("#TransportTypeId").val();
        if (transportTypeId == 'Prority')
            return;
        var priorityTypeId = $("#PriorityTypeId").val();
        if (priorityTypeId == 'Transport Type')
            return;


        var promoCode = $("#PromoCode").val();

        if (quantity != '' && amount != '' && transportTypeId != '' && priorityTypeId != '') {
          //  alert("weight " + weight + "quantity:" + quantity + "amount:" + amount + "transportTypeId:" + transportTypeId + "priorityTypeId:" + priorityTypeId);

            $.ajax({
                url: '@Url.Action("CalculateAmount","rates")', // to get the right path to controller from TableRoutes of Asp.Net MVC
                dataType: "json", //to work with json format
                type: "POST", //to do a post request

                //  contentType: 'application/json; charset=utf-8', //define a contentType of your request
                cache: false, //avoid caching results
                data: { zipFrom: pickupZip, zipTo: delZip, weight: weight, qty: quantity, priority: priorityTypeId, transportTypeId: transportTypeId, promoCode: promoCode }, // here you can pass arguments to your request if you need
                success: function (data) {
                    // data is your result from controller
                    if (data) {

                        $("#subtotal").text(data.strSubTotal);
                        $("#TaxDiscount").text(data.strDiscount);
                        $("#totalTax").text(data.strTaxAmount);
                        $("#total").text(data.strAmountToCharge);

                    }

                },
                error: function (xhr, ajaxOptions, thrownError) {
                    alert(xhr.responseText);
                    //alert(xhr.status);
                    //alert(thrownError);

                }
            });
        }
    }





    </script>

}
